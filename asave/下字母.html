<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>canvas特效2</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #canvas{
            background-color: #000;
        }
    </style>
</head>
<body>
    <!-- 1、创建全屏大小，黑色背景的canvas -->
    <canvas id="canvas">浏览器不支持canvas</canvas>
    <script>
        window.onload = function() {
            //获取画布上下文
	    let canvas = document.getElementById("canvas")
            let context =canvas.getContext("2d")
            // 设置画布宽高，铺满整个屏幕
            let W = window.innerWidth
            let H = window.innerHeight
            canvas.width = W;
            canvas.height = H;
            let y = 0
            // let str = "abcdefghijklmnopqrstuvwsyz"
            // let str = "anopqruvwsy"
            let str = "anop qruv wsy"
            let colunms = Math.floor(W / 16) // 一共需要多少行
            let dropArr = [] // 每一行的初始y位置都是0
            for(let i = 0; i < colunms; i++){
                dropArr.push(0)
            }
            function draw(){
                // 3、重绘画布
                context.fillStyle = "rgba(0,0,0,.08)"
                // context.fillStyle = randColor()
                context.fillRect(0,0,W,H)
                // 2、实现字符下落
                // context.font = "700 "+"16"+"px/16px  微软雅黑"
                // context.fillStyle = randColor()
                // let ty = y*16;
                // context.fillText('e',100,ty)
                // if(ty >= H){
                //     y=0;
                // }
                // y++;
                // 2.1 实现随机不同字符下落
                // context.font = "700 "+"16"+"px 微软雅黑"
                // context.fillStyle = randColor()
                // let word = str[Math.floor(Math.random() * str.length)]
                // let ty = y*16;
                // context.fillText(word,100,ty)
                // if(ty >= H){
                //     y=0;
                // }
                // y++;
                // 4、多行字符下落
                // context.font = "700 "+"16"+"px 微软雅黑"
                // context.fillStyle = randColor()
                // let word = str[Math.floor(Math.random() * str.length)]
                // let colunms = Math.floor(W / 16) // 一共需要多少行
                // let ty = y*16;
                // for(let i = 0; i<colunms; i++){
                //     let word = str[Math.floor(Math.random() * str.length)]
                //     context.fillStyle = randColor()
                //     let tx = i*16;
                //     context.fillText(word,tx,ty)
                // }
                // if(ty >= H){
                //     y=0;
                // }
                // y++;
                // 4.1 让每一列随机不同高度下落
                context.font = "700 16px 微软雅黑"
                // let ty = y*16;
                for(let i = 0; i<colunms; i++){
                    // 每一行字母都需要一个y
                    let ty = dropArr[i]*16;
                    let word = str[Math.floor(Math.random() * str.length)]
                    context.fillStyle = randColor()
                    let tx = i*16;
                    context.fillText(word,tx,ty)
                    if(ty >= H && Math.random() < 0.01){
                        dropArr[i] = 0
                    }
                    dropArr[i]++;
                }
                // 4.3 完成版
                // context.font = "700 16px 微软雅黑"
                // for(let i = 0; i<colunms; i++){
                //     // 每一行字母都需要一个y
                //     let ty = dropArr[i]*16;
                //     let word = str[Math.floor(Math.random() * str.length)]
                //     context.fillStyle = randColor()
                //     let tx = i*16;
                //     context.fillText(word,tx,ty)
                //     if(ty >= H && Math.random()<0.01){
                //         dropArr[i] = 0
                //     }
                //     dropArr[i]++;
                // }
            }
            // draw()
            setInterval(draw,30)
            function randColor(){
                let r = Math.floor(Math.random() * 256)
                let g = Math.floor(Math.random() * 256)
                let b = Math.floor(Math.random() * 256)
		        return "rgb("+r+","+g+","+b+",1)"
                // let o = 0.05;
                // return "rgb("+r+","+g+","+b+","+o+")"
            }
        }
    </script>
</body>
</html>
